<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article Submission</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Submit an Article</h1>
    <form id="articleForm">
        <label for="url">Article URL:</label>
        <input type="text" id="url" name="url" placeholder="Enter article URL" required>
        <span id="error-message" class="error"></span>
        <button type="button" id="submitButton">Submit</button>
    </form>

    <!-- Firebase and Form Logic -->
    <script type="module">
        // Firebase setup
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBnjBn6sTwnqDjrMXdgmFZ2dugrL5OVLTI",
            authDomain: "news-bias-analyzer.firebaseapp.com",
            projectId: "news-bias-analyzer",
            storageBucket: "news-bias-analyzer.appspot.com",
            messagingSenderId: "661563307465",
            appId: "1:661563307465:web:648bdabecbcf57b0d96418"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Valid news domains
        const validDomains = [
            'nytimes.com', 'bbc.com', 'cnn.com', 'theguardian.com', 'reuters.com',
            'washingtonpost.com', 'forbes.com', 'bloomberg.com', 'aljazeera.com',
            'npr.org', 'medium.com', 'hbr.org', 'wired.com', 'theatlantic.com',
            'techcrunch.com', 'businessinsider.com', 'nationalgeographic.com',
            'vox.com', 'economist.com', 'newyorker.com'
        ];

        // URL Validation
        function isValidUrl(urlString) {
            try {
                let url = new URL(urlString);
                return true;
            } catch (_) {
                return false;
            }
        }

        function isNewsSource(urlString) {
            let url = new URL(urlString);
            let domain = url.hostname.replace('www.', '').toLowerCase();
            return validDomains.includes(domain);
        }

        // Submit button event listener
        document.getElementById("submitButton").addEventListener("click", async function (event) {
            event.preventDefault();
            const url = document.getElementById("url").value;
            const errorMessage = document.getElementById("error-message");

            // Validate URL format
            if (!isValidUrl(url)) {
                errorMessage.textContent = "Invalid URL format.";
                return;
            }

            // Validate news source
            if (!isNewsSource(url)) {
                errorMessage.textContent = "Not a recognized news source.";
                return;
            }

            errorMessage.textContent = ""; // Clear any error messages

            try {
                // Store valid URL in Firebase
                await addDoc(collection(db, "Articles"), {
                    article_url: url,
                    submission_date: new Date()
                });
                alert('URL successfully submitted and stored in Firebase!');
            } catch (error) {
                console.error("Error adding document:", error);
            }
        });
    </script>
</body>
</html>
